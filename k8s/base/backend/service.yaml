# ============================================================================
# SERVICE - Expose Pods ra network và load balancing
# ============================================================================
# Service cung cấp:
# 1. Stable IP address (Pod IP thay đổi khi restart, Service IP không đổi)
# 2. DNS name (backend-api-service.default.svc.cluster.local)
# 3. Load balancing giữa các Pods
# ============================================================================

apiVersion: v1                     # API version cho Service
kind: Service                      # Loại resource: Service
metadata:
  name: backend-api-service        # Tên Service - dùng làm DNS name
                                   # Frontend gọi: http://backend-api-service/api/time
  labels:
    app: backend-api               # Label để filter: kubectl get svc -l app=backend-api

spec:
  # ============================================================================
  # SERVICE TYPE - Cách expose Service
  # ============================================================================
  # ClusterIP (default): Chỉ truy cập được từ trong cluster
  #   → Dùng cho: Backend API, Database, Internal services
  #   → KHÔNG thể truy cập từ browser/internet
  #
  # NodePort: Expose qua port trên mỗi Node (30000-32767)
  #   → Dùng cho: Development, testing
  #   → Truy cập: http://localhost:<nodePort>
  #
  # LoadBalancer: Tạo external load balancer (cloud provider)
  #   → Dùng cho: Production trên cloud (AWS, GCP, Azure)
  #   → Tự động có Public IP
  # ============================================================================
  type: ClusterIP                  # Internal only - Ingress sẽ route traffic vào

  selector:
    app: backend-api

  ports:
  - port: 80
    targetPort: 8080
    protocol: TCP

# ============================================================================
# FLOW: Frontend gọi Backend
# ============================================================================
#
#   Frontend Pod                    Service                      Backend Pods
#   ┌─────────┐                    ┌─────────┐                  ┌─────────┐
#   │  React  │ ──── port 80 ────▶ │ backend │ ── targetPort ─▶ │ Pod 1   │
#   │  App    │                    │ -api-   │     8080         │ :8080   │
#   └─────────┘                    │ service │                  ├─────────┤
#                                  │         │ ── targetPort ─▶ │ Pod 2   │
#   Gọi:                           │ClusterIP│     8080         │ :8080   │
#   http://backend-api-service     │10.43.x.x│                  └─────────┘
#   /api/time                      └─────────┘
#                                       ▲
#                                       │
#                              Load balances giữa
#                              tất cả Pods có label
#                              app=backend-api
# ============================================================================
